@page "/login"
@inject JournalApp.Services.AuthService Auth
@inject NavigationManager Nav

<div class="page-header">
    <div>
        <h1 class="h-title">üîê Login</h1>
        <p class="h-sub">Sign in to access your journal.</p>
    </div>
</div>

<div class="card" style="max-width:420px; margin:auto;">
    <div class="field">
        <div class="label">Username</div>
        <input class="input" @bind="_username" placeholder="admin" />
    </div>

    <div class="field">
        <div class="label">Password</div>
        <input class="input" type="password" @bind="_password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
    </div>

    @if (!string.IsNullOrWhiteSpace(_error))
    {
        <div class="card soft" style="padding:.85rem; margin-top:10px;">
            <b style="color:var(--danger)">@_error</b>
        </div>
    }

    <div style="display:flex; gap:10px; margin-top:12px;">
        <button class="btn primary" style="width:100%;" @onclick="DoLogin" disabled="@_busy">
            @(_busy ? "Logging in..." : "Login")
        </button>
    </div>

    <div class="helper" style="margin-top:10px;">
        Demo: <b>admin / admin123</b>
    </div>
</div>

@code {
    private string _username = "";
    private string _password = "";
    private string _error = "";
    private bool _busy = false;

    protected override void OnInitialized()
    {
        Auth.EnsureSeedUser();

        // If already logged in, go directly
        if (Auth.IsLoggedIn)
            Nav.NavigateTo("/", true);
    }

    private Task DoLogin()
    {
        _error = "";
        _busy = true;

        try
        {
            var ok = Auth.Login(_username, _password);
            if (ok)
                Nav.NavigateTo("/", true);
            else
                _error = "Invalid username or password.";
        }
        finally
        {
            _busy = false;
        }

        return Task.CompletedTask;
    }
}